package dev.isnow.puppy.exploit.impl.other;

import dev.isnow.puppy.exception.ExploitException;
import dev.isnow.puppy.exploit.Exploit;
import dev.isnow.puppy.exploit.ExploitInfo;
import dev.isnow.puppy.exploit.ExploitType;
import dev.isnow.puppy.exploit.argument.Argument;
import dev.isnow.puppy.helper.PlayerHelper;

@ExploitInfo(
    name = "Spam",
    type = ExploitType.OTHER,
    description = "Some shitty spammer (msg all)"
)
public class SpamExploit extends Exploit {

  public SpamExploit() {
    super(
        new Argument("command, for example: \"/msg\"", 0, String.class),
        new Argument("delay", 1, Long.class),
        new Argument("message", 2, String[].class)
    );
  }

  @Override
  public void execute(Object... args) throws ExploitException {
      if (mc.thePlayer != null && !mc.isSingleplayer()
              && mc.getNetHandler().getPlayerInfoMap() != null) {

          PlayerHelper.getOnlinePlayer()
                  .forEach(playerInfo -> {
                      if (mc.thePlayer == null || mc.getNetHandler().getPlayerInfoMap() == null) {
                          throw new ThreadDeath();
                      }

                      try {
                          mc.thePlayer.sendChatMessage(
                                  args[0] + " " + playerInfo.getName() + " " + args[2]);
                          System.out
                                  .println(args[0] + " " + playerInfo.getName() + " " + args[2]);
                          Thread.sleep((Long) args[1]);
                      } catch (Exception e) {
                          e.printStackTrace();
                      }
                  });
      }
  }
}
